○概要
Illustratorでの一括ルビ振りを補助するスクリプトです。


○ルビとは？
日本語は時として「世界一難しい言語」と称されます。ひらがな、カタカナに加えて、膨大な数が存在する漢字、更には多言語である欧文が混在するからです。
中でも厄介なのが漢字で、埼玉県蕨（わらび）市などの難解な地名、「本気」と書いて「まじ」、「運命」で「定め」と読むなどの特殊な例や、キラキラネームと呼ばれる名前の出現などによって、日本語読解の混沌化は留まるところを知りません。そうした多様化するニーズに応えるべく、日本語組版には「ルビ」といった独自の文化が存在し、広く用いられています。

「ルビ」とは児童向けの絵本や小説などの他、一般書でも読み難いであろう漢字に振られる小さな読み仮名のことです。宝石の ruby を語源にしているそうです。
しかしながら、海外で開発されたアプリケーションはそれら日本語組版にはめっぽう弱く、高度な組版が可能なIllustratorであっても標準でルビを振る機能は存在しません。（割注などを駆使すれば実現不可能な訳ではありませんが…）


○ルビの基本
・「清澄白河」といった単語にルビを振る場合、（角括弧内はルビ）
・清［きよ］澄［すみ］白［しら］河［かわ］
・清澄白河［きよすみしらかわ］
といったように２つの振り方が存在します。前者のように漢字一字毎にルビを振る方法を「モノルビ」、後者のように単語ごとにルビを振る方法を「グループルビ」と呼びます。熟字訓などには多くの場合、グループルビが使用されます。

・「東京」や「四日市」といった単語にルビをふる際、
・［とうきょう］［よっかいち］
・［とうきよう］［よつかいち］
といった２つの表記の仕方が存在します。一般的には後者のように ぁ ぃ ぅ ぇ ぉ っ ゃ ゅ ょ ゎ などの小さな字（捨て仮名）は使用しません。（児童書等には例外あり）

・ルビを振る際、ルビを右／上に寄せる組み方の「肩付き」と中央に寄せる「中付き」が存在します。縦組みはどちらを使用しても構いませんが、横組みに肩付きルビを使用するのはルール違反です。


○使用の前にご留意ください
記述される項目を熟読し、よく理解した上でご使用ください。
・本スクリプトを使用したことによって発生したあらゆる損害・損失について、配布者は一切責任を負わないものとします。
　スクリプトを使用する前に、ファイルのバックアップを取ることを推奨します。
・商用／非商用に関わらずご自由にご使用ください。
・利用料金／ライセンス料等は一切掛かりません。
・本スクリプトは、全てのバージョンで動作することを保証するものではありません。
・無断でソースコードに手を加えていただいても構いません。使い易く改良してお使いください。
・記録媒体や電子メールなどを用いて、本スクリプトを友人、知人、家族間や職場内で共有していただいても構いません。
　但し、本スクリプト或いはそれに手を加えたものを、無断で不特定多数（例：インターネット上で）の方に頒布する、頒布可能な状態にすることは禁じます。
　再配布を希望される際は配布者にご相談ください。配布者に無断で公開された場合、ファイルの削除を求める場合があります。
・配布者は、本スクリプトについてのサポート等の義務を負わないものとします。
・配布者は、本スクリプトの頒布を予告なく中止する場合があります。
・配布者は、本スクリプト及びその使用条件を予告なく変更する場合があります。


○主な仕様
・ポイントテキスト、エリア内テキストの縦／横組み両方に対応しています。
・パス上テキストは横組みのみ対応しています。この際、ルビは水平に配置されます。（パスに沿っては配置されません）
・スレッドテキスト、パス上テキスト（縦組み）には対応していません。


○使用手順
１．ダウンロードしたzipファイルを適当な場所に解凍します。
２．Illustratorでルビを振りたいファイルを開き、ルビを振るテキストフレームを finish を含めた名前にリネームします。
３．２のテキストフレームをコピーし、base を含めた名前にリネームします。base側のテキストは後記の「ルビの記述方法」に則って編集していきます。（finish側はそのまま）
４．２、３で編集したテキストフレームbase、finishを対になるように1つずつ選択（順序は問いません）し、ファイル＞スクリプトから１で解凍したフォルダ内の ruby.jsx を実行します。


○ルビの記述方法
●漢字などにルビを振る
	・ルビを振りたい文字を [ と ]（半角角括弧）で囲みます。漢字と仮名の間は [（初め半角角括弧）で区切ります。
	　記述例１）「清澄白河」を［きよ］［すみ］［しら］［かわ］とモノルビ（前述）で記述したい	→　[清[きよ][澄[すみ][白[しら][河[かわ]
	　記述例２）「清澄白河」を［きよすみしらかわ］とグループルビ（前述）で記述したい			→　清澄白河[きよすみしらかわ]
	・ [ をそのまま記述したい場合は [[ と表記します。

●属性を指定する
	・細かな設定（配置など）を指定可能です。( プロパティ名 ( 値 ) といった形で記述します。
	・属性を特に指定しなかった場合、基準値が適用されます。値に base を指定すると、基準値を指定出来ます。
	・ ( をそのまま記述したい場合は )) と表記します。
	・align
		・概要　：ルビの配置を指定します。
		・値　　：kata	・肩付き
		　　　　　naka	・中付き
		・基準値：kata（肩付き）
		・記述例：(align:naka)清[きよ]澄[すみ]白[しら]河[かわ]
	・size
		・概要　：ルビのサイズを指定します。
		・値　　：数値＋単位
		・基準値：ルビを振る親テキストのサイズの1/2
		・記述例：(size(8Q)清[きよ]澄[すみ]白[しら]河[かわ]
	・font
		・概要　：ルビのフォントを指定します。
		・値　　：指定するフォントのPostScript名
		・基準値：ルビを振る親テキストのフォント
		・記述例：(font(KozGoPro-H)清[きよ]澄[すみ]白[しら]河[かわ]
		・備考　：和文フォントPS name：http://upright.na.coocan.jp/fuzokufont/wabunfont.html
	・offset
		・概要　：ルビの位置のオフセット（基準点からの差分）を指定します。
		・値　　：数値＋単位
		・基準値：0
		・記述例：(offset(2Q)清澄白河(offset(1Q)清[きよ]澄[すみ]白[しら]河[かわ]
	・sutegana
		・概要	：捨て仮名（先述）を使用するか指定します。
		・値	：true	・捨て仮名を使用する
		　　　　　false	・捨て仮名を使用しない（自動的に変換される）
		・基準値：false（捨て仮名を使用しない）
		・記述例：(sutegana(true)[東京特許許可局局長[とうきょうとっきょきょかきょくきょくちょう]
	・narrow
		・概要　：ルビがルビを振る親テキストに収まりきらない場合、縦組みの場合垂直方向（長体）を、横組みの場合水平方向（平体）を縮めて調節します。
		・値　　：true	・自動的に調節する
		　　　　　false	・自動的に調節しない
		・基準値：true（自動的に調節する）
		・記述例：(narrow(false)[標準[デファクト・スタンダード]

●使用できる単位
	・pt		（絶対値）1pt ≒ 0.352mm
	・cm		（絶対値）1cm ≒ 28.346pt
	・mm		（絶対値）10mm = 1cm
	・Q／H		（絶対値）1Q（1H）≒ 0.25mm
	・px		（絶対値）1px = 0.75pt
	・％		（相対値）ルビを振る親テキストのサイズの x％


●（記述例）ルビを振るテキスト（名前：清澄白河finish）
ちらっと、さわり――清澄白河
先日、といっても既に１年を経てしまいましたが。先日、清澄白河（東京都江東区）という地に足を踏み入れました。人生初です。
――何と言っても地名が綺麗ですね。清く、澄んだ、白い、河。英語にしてBeautiful clear  white river.そうなるとやはり興味を惹かれるのは街並み。これがまた、〝下町〟という言葉がしっくり来るそれだった訳です。私も川崎に住み始めて彼此10年になりますが、やはり妙に親近感を覚えるといいますか。都内在住の方からは「あんな街と同じ類で扱うな！」とお叱りを受けそうですが、それが私としての率直な感想でございます。しかしながら魅力ありますよ、この街。

●（記述例）ルビを含んだテキスト（名前：清澄白河base）
(font(RyuminStd-Regular)(align(naka)ちらっと、さわり―[清[きよ][澄[すみ][白[しら][河[かわ]
(size(base)(align(kata)(offset(3px)先日、といっても既に１年を経てしまいましたが。先日、[清[きよ][澄[すみ][白[しら][河[かわ]（東京都[江[こう][東[とう]区）という地に足を踏み入れました。人生初です。
――何と言っても地名が綺麗ですね。清く、[澄[す]んだ、白い、[河[かわ]。英語にして[Beautiful[ビューティフル] [clear[クリア] [white[ホワイト] [river[リバー].そうなるとやはり興味を[惹[ひ]かれるのは街並み。これがまた、〝下町〟という言葉がしっくり来るそれだった訳です。[私[わたくし]も川崎に住み始めて[彼此[かれこれ]10年になりますが、やはり妙に親近感を覚えるといいますか。都内在住の方からは「あんな街と同じ[類[たぐい]で扱うな！」とお叱りを受けそうですが、それが私としての[率直[そっちょく]な感想でございます。しかしながら魅力ありますよ、この街。


○よくありそうな質問
Ｑ．動作しない
Ａ．「finish」と「base」の文字列が含まれたテキストフレームを選択していますか？また、「base」のテキストが「finish」テキストに対になるよう、上記の「ルビの記述方法」に則って記述されているか、今一度ご確認ください。

Ｑ．それでも動かない
Ａ．バグの可能性があります。宜しければ、発生する現象と使用環境を後述の問い合わせ先までご一報ください。但し、報告を頂いても対応致しかねる場合があります。

Ｑ．文字を修正したらルビも自動的に追随したりしない？
Ａ．しません。ルビを消してもう一度実行し直すことをお薦めします。

Ｑ．縦組みの文章中に欧文や縦中横が出現するとルビがずれる気がするんですけど…？
Ａ．ルビの配置位置をどのようにして決定しているかというと、（縦組みの場合）ルビを振る文字のx座標を取得→1行中の平均x座標を取得→配置　といった流れで配置しているんですね。故にルビを振る文字が幅狭／幅広なグリフだとルビがずれる場合があります。一行中のルビの位置は揃うように調節してあります。

Ｑ．GUIで操作出来たりしませんか
Ａ．出来ません。

Ｑ．OpenTypeのルビ用字形は使用出来ませんか？
Ａ．出来ません。Illustrator的にも未対応です。但し、ルビを振る文字とルビで違うフォントを指定することは可能です。

Ｑ．グループルビが行末・行頭に架かった際、ルビがとんでもない位置に配置されるのですが？
Ａ．仕様です。大抵の場合、手動で分離禁止処理を施せば解決するはずです。

Q．テキストフレームがグループ化されているとうまく動作しないのですが
A．グループとして選択するのではなく、テキストフレーム個々を選択してください。それでも解決しない場合は申し訳ありませんが、グループを解除してからお試しください。

Ｑ．フォントを指定したのに変わらないのですが
Ａ．PostScriptを正確に指定出来ていますか？例えばヒラギノ角ゴProN W3を指定したい場合は「HiraKakuProN-W6」と指定する必要があります。

Ｑ．Illustratorがクラッシュしてしまったのですが
Ａ．try~catch文で必要なところは囲んでいるので（多分）大丈夫なはずですが、稀にIllustrator自体が落ちることもあります。バックアップはお忘れなく。

Ｑ．エラーメッセージの英語がおかしい
Ａ．ご指摘ありがとうございます。英語苦手なので、間違っている部分を下記連絡先までお願いします。

Ｑ．利用条件が不明瞭なのですが
Ａ．商用／非商用、用途は問いません。（大したものでもないですし）
　　「これ大丈夫かな？」と心配されるようでしたら、軽ーく聞いてくだされば軽ーく可否についてお答えするつもりです。

`問い合わせ先
問い合わせはDMかリプライ（Twitter）或いは、適当なコメント欄（はてなブログ）にお願いします。
・Twitter		：@fontnow
・はてなブログ	：http://unique.hatenablog.com/

©2016 fontnow.